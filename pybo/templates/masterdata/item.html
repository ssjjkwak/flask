{% extends "base.html" %}
{% block content %}

<style>
    .selected-row {
        background-color: #D6EAF8 !important;
    }

    .completed-item {
        background-color: #e0ffff !important;
    }

    th {
        background-color: #f8f9fa;
        box-shadow: 0 3px 3px -1px rgba(0, 0, 0, 0.4);
        position: sticky;
        top: 0;
        z-index: 20;
    }

    .table-wrapper {
        overflow: auto;
        height: calc(100vh - 300px); /* 화면 높이에 따라 조절 */
        width: 100%;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        min-width: 50px;
    }
</style>

<!-- 조회조건 -->
<div>
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 15px 15px 0;">
        <h7 class="m-0 font-weight-bold text-primary mb-3">기준정보 > 품목정보조회</h7>
        <div style="display: flex; gap: 10px; align-items: center;">
            <button type="button" class="btn btn-light btn-sm shadow-sm ms-3" data-toggle="modal"
                    data-target=".bd-example-modal-lg" id="openModalButton"><i class="bi bi-card-checklist"></i>
                품목정보 수정
            </button>
            <button type="submit" form="searchForm" class="btn btn-light btn-sm shadow-sm ms-3">
                <i class="bi bi-search"></i> 조회
            </button>
        </div>
        <!-- 모달 -->
        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">품목 정보 수정</h5>
                    </div>
                    <div class="modal-body">
                        <!-- 모달 내용 여기에 -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" form="productForm" class="btn btn-light shadow-sm ms-3"
                                id="saveButton">저장
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form method="POST" action="{{ url_for('masterdata.item') }}" class="px-4" id="searchForm">
        <input type="hidden" name="form_submitted" value="True">
        <div class="row">
            <div class="col-md-3">
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="plant_code" class="form-label me-3" style="min-width: 110px;">공장</label>
                    <select class="form-select form-select-sm" id="plant_code" name="plant_code">
                        <option value="">-</option>
                        {% for plant in plants %}
                        <option value="{{ plant.PLANT_CD }}" {% if plant.PLANT_CD == PLANT_CD %}selected{% endif %}>
                            {{ plant.PLANT_CD }} {{ plant.PLANT_NM }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="item_cd" class="form-label me-3" style="min-width: 110px;">품목</label>
                    <input type="text" class="form-control form-control-sm" id="item_cd" name="item_cd"
                           value="{{ ITEM_CD }}">
                </div>
            </div>
            <div class="col-md-3">
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="item_nm" class="form-label me-3" style="min-width: 110px;">제품명</label>
                    <input type="text" class="form-control form-control-sm" id="item_nm" name="item_nm"
                           value="{{ ITEM_NM }}">
                </div>
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="spec" class="form-label me-3" style="min-width: 110px;">품목계정</label>
                    <input type="text" class="form-control form-control-sm" id="spec" name="spec" value="{{ SPEC }}">
                </div>
            </div>
            <div class="col-md-3">
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="item_nm" class="form-label me-3" style="min-width: 110px;">표준코드(DI)</label>
                    <input type="text" class="form-control form-control-sm" id="UDI_DI" name="item_nm"
                           value="{{ ITEM_NM }}">
                </div>
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="spec" class="form-label me-3" style="min-width: 110px;">품목그룹</label>
                    <input type="text" class="form-control form-control-sm" id="item_group" name="spec" value="{{ SPEC }}">
                </div>
            </div>
            <div class="col-md-3">
                <div class="mb-1 col-9 d-flex align-items-center">
                    <label for="alpha_code" class="form-label me-3" style="min-width: 110px;">알파코드(제품)</label>
                    <input type="text" class="form-control form-control-sm" id="alpha_code" name="alpha_code"
                           value="{{ ALPHA_CODE }}">
                </div>
            </div>
        </div>
    </form>
</div>

<div class="gap" style="margin-top: 20px;"></div>

<div>
    <!--데이터 테이블-->
    <div>
        {% if items %}
        <div class="table-wrapper">
            <table class="table table-sm table-hover"
                   style="text-align: center; border-collapse: collapse;" id="dataTable" width="100%" cellspacing="0">
                <thead class="table-light">
                <tr>
                    <th>번호</th>
                    <th>품목코드</th>
                    <th>품목명</th>
                    <th>규격</th>
                    <th>단위</th>
                    <th>알파코드</th>
                </tr>
                </thead>

                <tbody>
                {% for item in items %}
                <tr data-item-cd="{{ item.ITEM_CD }}">
                    <td>{{ loop.index }}</td>
                    <td>{{ item.ITEM_CD }}</td>
                    <td>{{ item.ITEM_NM }}</td>
                    <td>{{ item.SPEC }}</td>
                    <td>{{ item.BASIC_UNIT }}</td>
                    <td>{{ item.ALPHA_CODE }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning" role="alert">
            조회 결과가 없습니다.
        </div>
        {% endif %}
    </div>
</div>

<script>
    var selectedItemCd = '';

    document.querySelectorAll('#dataTable tbody tr').forEach(row => {
        row.addEventListener('click', function() {
            // 모든 행에서 selected-row 클래스 제거
            document.querySelectorAll('#dataTable tbody tr').forEach(row => {
                row.classList.remove('selected-row');
            });

            // 클릭된 행에 selected-row 클래스 추가
            this.classList.add('selected-row');

            // 선택된 품목 코드 저장
            selectedItemCd = this.getAttribute('data-item-cd');
        });
    });

    document.getElementById('openModalButton').addEventListener('click', function() {
        if (selectedItemCd) {
            // 모달을 열고 해당 품목 데이터를 가져와서 수정
            fetchModalData(selectedItemCd);
        } else {
            alert('조회할 품목을 선택해주세요.');
        }
    });

    function fetchModalData(itemCd) {
        // 품목 데이터를 가져오는 로직 (추후 구현)
        console.log('품목코드: ' + itemCd);
    }
</script>

{% endblock %}
